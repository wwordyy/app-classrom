
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id Int @id @default(autoincrement())
  email String @unique 
  passwordHash String @map("password_hash")
  fullName String @map("full_name") @db.VarChar(255)
  avatarUrl String? @map("avatar_url")
  isActive Boolean @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")

  role Role @relation(fields: [roleId], references: [id])
  roleId Int
  group Group? @relation(fields: [groupId], references: [id])
  groupId Int? @map("group_ID")

  streams Stream[]
  submissions Submission[]
  postComments PostComment[]
  chatMessages ChatMessage[]
  chats ChatUser[]
  documentParts DocumentPart[]

  @@map("Users")
}


model Role {
    id Int @id @default(autoincrement())
    title String @unique @db.VarChar(25)
    users User[]

    @@map("Roles")
}

model Group {
    id Int @id @default(autoincrement())
    name String @db.VarChar(50)
    courseYear Int @map("course_year")

    users User[]
    streams StreamGroup[]

    @@map("Groups")
}

model Stream{
  id Int @id @default(autoincrement())
  title String @db.VarChar(100)
  description String 
  startDate DateTime @map("start_date")
  endDate DateTime @map("end_date")
  createdAt DateTime @default(now()) @map("created_at")
  
  teacher User @relation(fields: [teacherId], references: [id])
  teacherId Int @map("teacher_id")

  groups StreamGroup[]
  posts Post[]
  documentParts DocumentPart[]

  @@map("Streams")
}


model StreamGroup {
  stream Stream @relation(fields: [streamId], references: [id])
  streamId Int @map("stream_ID")

  group Group @relation(fields: [groupId], references: [id])
  groupId Int @map("group_ID")

  @@id([streamId, groupId])
  @@map("StreamsGroups")
}

model Post {
    id Int @id @default(autoincrement())
    title String @db.VarChar(50)
    content String
    dueDate DateTime @map("due_date")
    maxScore Int @map("max_score")

    typePost TypePost @relation(fields: [typePostId], references: [id])
    typePostId Int @map("type_post_ID")

    stream Stream @relation(fields: [streamId], references: [id])
    streamId Int @map("stream_ID")

    submissions Submission[]
    postComments PostComment[]

    @@map("Posts")
}


model TypePost{
    id Int @id @default(autoincrement())
    title String @db.VarChar(50) @unique

    posts Post[]

    @@map("TypePosts")
}


model Submission {
    id Int @id @default(autoincrement())
    fileUrl String? @map("file_url")
    grade Int?
    submittedAt DateTime? @map("submitted_at")
    feedBackTeacher String? @map("feed_back_teacher")
    updatedAt DateTime @map("updated_at") @default(now()) 

    statusSubmission StatusSubmission @relation(fields: [statusSubmissionId], references: [id])
    statusSubmissionId Int @map("status_submission_ID")

    post Post @relation(fields: [postId], references: [id])
    postId Int @map("post_ID")

    user User @relation(fields: [userId], references: [id])
    userId Int @map("user_ID")

    @@map("Submissions")
}

model StatusSubmission{
    id Int @id @default(autoincrement())
    title String @db.VarChar(50) @unique

    submissions Submission[]

    @@map("StatusesSubmissions")
}


model PostComment{
    id Int @id @default(autoincrement())
    content String
    createdAt DateTime @default(now()) @map("created_at")

    post Post @relation(fields: [postId], references: [id])
    postId Int @map("post_ID")

    author User @relation(fields: [authorId], references: [id])
    authorId Int @map("author_ID")

    @@map("PostComments")
}


model Chat{
    id Int @id @default(autoincrement())
    title String? @db.VarChar(50) 
    createdAt DateTime @default(now()) @map("created_at")

    messages ChatMessage[]
    users ChatUser[]

    @@map("Chats")
}

model ChatMessage{
    id Int @id @default(autoincrement())
    content String
    createdAt DateTime @default(now()) @map("created_at")
    
    author User @relation(fields: [authorId], references: [id])
    authorId Int @map("author_ID")

    chat Chat @relation(fields: [chatId], references: [id])
    chatId Int @map("chat_ID")

    @@map("ChatMessages")
}


model ChatUser {
  id Int @id @default(autoincrement())

  chat  Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId Int  @map("chat_ID")

  user  User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int  @map("user_ID")

  @@unique([chatId, userId])
  @@map("ChatUsers")
}


model DocumentPart {
  id Int @id @default(autoincrement())
  fileUrl String @map("file_url")

  stream Stream @relation(fields: [streamId], references: [id])
  streamId Int @map("stream_ID")

  student User @relation(fields: [userId], references: [id])
  userId Int @map("user_ID")


  @@map("documentParts")
}


model DocumentType {
    id Int @id @default(autoincrement())
    title String @unique @db.VarChar(50)
    orderIndex Int @map("order_index")

    @@map("DocumentTypes")
}


